<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0a0a0a">
    <meta name="application-name" content="DeQ">
    <meta name="apple-mobile-web-app-title" content="DeQ">
    <title>DeQ</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/svg+xml" href="/icon.svg">
    <link rel="apple-touch-icon" href="/icon.svg">
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <script>
        // Onboarding flag set by server
        window.NEEDS_ONBOARDING = __NEEDS_ONBOARDING__;
    </script>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <a href="https://deq.rocks" target="_blank" rel="noopener" class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                    <rect class="icon-bg" width="512" height="512" rx="96"/>
                    <path d="M80 80 L210 80 Q230 80 230 100 L230 412 Q230 432 210 432 L80 432 Z" fill="none" stroke="currentColor" stroke-width="16"/>
                    <path d="M430 155 L432 100 Q432 80 412 80 L302 80 Q282 80 282 100 L282 210 Q282 230 302 230 L430 230" fill="none" stroke="currentColor" stroke-width="16" stroke-linecap="round"/>
                    <line x1="400" y1="155" x2="428" y2="155" stroke="currentColor" stroke-width="16" stroke-linecap="round"/>
                    <path class="icon-accent" d="M432 380 L432 302 Q432 282 412 282 L302 282 Q282 282 282 302 L282 412 Q282 432 302 432 L380 432" fill="none" stroke-width="16" stroke-linecap="round"/>
                    <line class="icon-accent" x1="405" y1="405" x2="435" y2="435" stroke-width="16" stroke-linecap="round"/>
                </svg>
            </a>
            <div class="header-actions">
                <button class="icon-btn" id="files-btn" title="File Manager">
                    <svg viewBox="0 0 512 512" fill="none">
                        <rect class="icon-bg" width="512" height="512" rx="96"/>
                        <path d="M60 80 L190 80 Q210 80 210 100 L210 412 Q210 432 190 432 L60 432 Z" stroke="currentColor" stroke-width="16"/>
                        <line x1="85" y1="140" x2="185" y2="140" stroke="currentColor" stroke-width="12" stroke-linecap="round"/>
                        <line x1="85" y1="190" x2="160" y2="190" stroke="currentColor" stroke-width="12" stroke-linecap="round"/>
                        <line x1="85" y1="240" x2="175" y2="240" stroke="currentColor" stroke-width="12" stroke-linecap="round"/>
                        <path class="icon-accent" d="M302 80 L432 80 Q452 80 452 100 L452 412 Q452 432 432 432 L302 432 Z" fill="none" stroke-width="16"/>
                        <line class="icon-accent" x1="327" y1="140" x2="427" y2="140" stroke-width="12" stroke-linecap="round"/>
                        <line class="icon-accent" x1="327" y1="190" x2="390" y2="190" stroke-width="12" stroke-linecap="round"/>
                        <line class="icon-accent" x1="327" y1="240" x2="410" y2="240" stroke-width="12" stroke-linecap="round"/>
                        <line class="icon-accent" x1="230" y1="256" x2="275" y2="256" stroke-width="16" stroke-linecap="round"/>
                        <path class="icon-accent" d="M265 246 L280 256 L265 266" fill="none" stroke-width="16" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <button class="icon-btn" id="edit-toggle" title="Edit mode">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <rect class="icon-bg" width="512" height="512" rx="96"/>
                        <path d="M340 100 L412 172 L172 412 L100 412 L100 340 Z" fill="none" stroke="currentColor" stroke-width="16" stroke-linejoin="round"/>
                        <line x1="140" y1="372" x2="172" y2="340" stroke="currentColor" stroke-width="16" stroke-linecap="round"/>
                        <line class="icon-accent" x1="340" y1="100" x2="412" y2="172" stroke-width="16" stroke-linecap="round"/>
                        <line x1="300" y1="140" x2="372" y2="212" stroke="currentColor" stroke-width="16" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Links Section -->
        <section class="section" id="links-section">
            <div class="section-header">
                <div class="section-header-left">
                    <span class="section-title">Links</span>
                    <button class="icon-btn section-add section-toggle" id="links-toggle" title="Hide section" onclick="App.toggleSection('links')">
                        <i data-lucide="eye-off"></i>
                    </button>
                    <button class="icon-btn section-add layout-btn" id="link-layout-btn" title="Change layout" onclick="App.cycleLinkLayout()">
                        <span id="link-layout-label">eco</span>
                    </button>
                    <button class="icon-btn section-add" id="mono-toggle" title="Toggle monochrome icons" onclick="App.toggleMonochrome()">
                        <i data-lucide="palette"></i>
                    </button>
                </div>
                <button class="icon-btn section-add" id="add-link" title="Add link">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
            </div>
            <div class="links-grid" id="links-grid"></div>
        </section>

        <!-- Devices Section -->
        <section class="section" id="devices-section">
            <div class="section-header">
                <div class="section-header-left">
                    <span class="section-title">Devices</span>
                    <button class="icon-btn section-add section-toggle" id="devices-toggle" title="Hide section" onclick="App.toggleSection('devices')">
                        <i data-lucide="eye-off"></i>
                    </button>
                </div>
                <button class="icon-btn section-add" id="scan-devices" title="Scan for devices" onclick="App.startOnboarding(true)">
                    <i data-lucide="radar"></i>
                </button>
                <button class="icon-btn section-add" id="add-device" title="Add device">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
            </div>
            <div id="devices-list"></div>
        </section>

        <!-- Tasks Section -->
        <section class="section" id="tasks-section">
            <div class="section-header">
                <div class="section-header-left">
                    <span class="section-title">Scheduled Tasks</span>
                    <button class="icon-btn section-add section-toggle" id="tasks-toggle" title="Hide section" onclick="App.toggleSection('tasks')">
                        <i data-lucide="eye-off"></i>
                    </button>
                </div>
                <button class="icon-btn section-add task-add" onclick="App.openTaskWizard()" title="Add task">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
            </div>
            <div id="tasks-list"></div>
        </section>

        <!-- Theme Section (edit mode only) -->
        <section class="section theme-section" id="theme-section">
            <div class="section-header">
                <span class="section-title">Theme</span>
            </div>
            <div class="theme-grid">
                <div class="theme-group">
                    <label class="theme-label">Background</label>
                    <div class="theme-color-input">
                        <input type="color" id="theme-bg" value="#161616">
                        <input type="text" class="theme-hex" id="theme-bg-hex" maxlength="7" value="#161616">
                    </div>
                </div>
                <div class="theme-group">
                    <label class="theme-label">Cards</label>
                    <div class="theme-color-input">
                        <input type="color" id="theme-cards" value="#151515">
                        <input type="text" class="theme-hex" id="theme-cards-hex" maxlength="7" value="#151515">
                    </div>
                </div>
                <div class="theme-group">
                    <label class="theme-label">Border</label>
                    <div class="theme-color-input">
                        <input type="color" id="theme-border" value="#2b2b2b">
                        <input type="text" class="theme-hex" id="theme-border-hex" maxlength="7" value="#2b2b2b">
                    </div>
                </div>
                <div class="theme-group">
                    <label class="theme-label">Text</label>
                    <div class="theme-color-input">
                        <input type="color" id="theme-text" value="#e0e0e0">
                        <input type="text" class="theme-hex" id="theme-text-hex" maxlength="7" value="#e0e0e0">
                    </div>
                </div>
                <div class="theme-group">
                    <label class="theme-label">Text Muted</label>
                    <div class="theme-color-input">
                        <input type="color" id="theme-text-muted" value="#b6b6b6">
                        <input type="text" class="theme-hex" id="theme-text-muted-hex" maxlength="7" value="#b6b6b6">
                    </div>
                </div>
                <div class="theme-group">
                    <label class="theme-label">Accent</label>
                    <div class="theme-color-input">
                        <input type="color" id="theme-accent" value="#2ed573">
                        <input type="text" class="theme-hex" id="theme-accent-hex" maxlength="7" value="#2ed573">
                    </div>
                </div>
            </div>
            <div class="theme-row">
                <div class="theme-group theme-group-wide">
                    <label class="theme-label">Transparency</label>
                    <div class="theme-slider-row">
                        <input type="range" id="theme-glass" min="0" max="100" value="0" class="theme-slider">
                        <span id="theme-glass-value">0%</span>
                    </div>
                </div>
                <div class="theme-group theme-group-wide">
                    <label class="theme-label">Blur</label>
                    <div class="theme-slider-row">
                        <input type="range" id="theme-blur" min="0" max="30" value="0" class="theme-slider">
                        <span id="theme-blur-value">0px</span>
                    </div>
                </div>
            </div>
            <div class="theme-group theme-group-full">
                <label class="theme-label">Wallpaper</label>
                <input type="text" class="form-input" id="theme-wallpaper" placeholder="https://example.com/wallpaper.jpg">
                <div class="form-hint">Image URL (https://...)</div>
            </div>
            <div class="theme-actions">
                <button type="button" class="btn btn-secondary" onclick="App.resetTheme()">Reset to Defaults</button>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <span class="version" id="version">v0.9.7</span>
        </footer>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Link Modal -->
    <div class="modal" id="link-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="link-modal-title">Add Link</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Name</label>
                <input type="text" class="form-input" id="link-name" placeholder="My Service">
            </div>
            <div class="form-group">
                <label class="form-label">URL</label>
                <input type="url" class="form-input" id="link-url" placeholder="https://...">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Icon (Lucide)</label>
                    <input type="text" class="form-input" id="link-icon" placeholder="link">
                    <div class="form-hint">See lucide.dev/icons</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Icon URL</label>
                    <input type="url" class="form-input" id="link-icon-url" placeholder="https://...">
                    <div class="form-hint">Or use custom image</div>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="UI.hideModal('link-modal')">Cancel</button>
                <button type="button" class="btn" onclick="App.saveLink()">Save</button>
            </div>
        </div>
    </div>

    <!-- Device Modal -->
    <div class="modal" id="device-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="device-modal-title">Add Device</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Name</label>
                <input type="text" class="form-input" id="device-name" placeholder="My Server">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">IP Address</label>
                    <input type="text" class="form-input" id="device-ip" placeholder="192.168.1.100">
                </div>
                <div class="form-group">
                    <label class="form-label">Icon</label>
                    <select class="form-input" id="device-icon">
                        <option value="server">Server</option>
                        <option value="cpu">CPU</option>
                        <option value="hard-drive">Hard Drive</option>
                        <option value="monitor">Monitor</option>
                        <option value="laptop">Laptop</option>
                        <option value="smartphone">Smartphone</option>
                        <option value="router">Router</option>
                        <option value="wifi">WiFi</option>
                        <option value="database">Database</option>
                        <option value="cloud">Cloud</option>
                    </select>
                </div>
            </div>
            <div class="form-section">
                <div class="form-section-title">Wake on LAN (optional)</div>
                <div class="form-group">
                    <label class="form-label">MAC Address</label>
                    <input type="text" class="form-input" id="device-mac" placeholder="AA:BB:CC:DD:EE:FF">
                </div>
            </div>
            <div class="form-section">
                <div class="form-section-title">SSH Access (optional)</div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">SSH User</label>
                        <input type="text" class="form-input" id="device-ssh-user" placeholder="root">
                    </div>
                    <div class="form-group">
                        <label class="form-label">SSH Port</label>
                        <input type="number" class="form-input" id="device-ssh-port" value="22">
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="UI.hideModal('device-modal')">Cancel</button>
                <button type="button" class="btn" onclick="App.saveDevice()">Save</button>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div class="modal" id="task-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add Task</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Task Name</label>
                <input type="text" class="form-input" id="task-name" placeholder="My Task">
            </div>
            <div class="form-group">
                <label class="form-label">Task Type</label>
                <div class="task-type-options">
                    <label class="task-type-option">
                        <input type="radio" name="task-type" value="docker">
                        <div class="task-type-label">
                            <i data-lucide="box"></i>
                            <strong>Docker</strong>
                            <small>Container action</small>
                        </div>
                    </label>
                    <label class="task-type-option">
                        <input type="radio" name="task-type" value="command">
                        <div class="task-type-label">
                            <i data-lucide="terminal"></i>
                            <strong>Command</strong>
                            <small>Shell command</small>
                        </div>
                    </label>
                    <label class="task-type-option">
                        <input type="radio" name="task-type" value="http">
                        <div class="task-type-label">
                            <i data-lucide="globe"></i>
                            <strong>HTTP</strong>
                            <small>Web request</small>
                        </div>
                    </label>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="UI.hideModal('task-modal')">Cancel</button>
                <button type="button" class="btn">Next</button>
            </div>
        </div>
    </div>

    <!-- Onboarding Modal -->
    <div class="modal" id="onboarding-modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">Welcome to DeQ</h3>
                <button class="modal-close">&times;</button>
            </div>
            <p style="margin-bottom: 16px; color: var(--text-secondary);">
                Let's scan your network to find devices. Select the ones you want to add to your dashboard.
            </p>
            <div id="onboarding-content">
                <div style="text-align: center; padding: 40px;">
                    <p>Click "Scan Network" to discover devices</p>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="UI.hideModal('onboarding-modal')">Skip</button>
                <button type="button" class="btn" onclick="App.completeOnboarding()">Add Selected</button>
            </div>
        </div>
    </div>

    <!-- File Manager Modal -->
    <div class="modal fm-fullscreen" id="file-manager-modal">
        <div class="modal-content fm-modal">
            <div class="modal-header">
                <h3 class="modal-title">File Manager</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="fm-container">
                <!-- Left Pane -->
                <div class="fm-pane" id="fm-pane-left">
                    <div class="fm-pane-header">
                        <select class="form-input" id="fm-device-left" onchange="App.fm.leftDevice = this.value; App.loadFilePane('left')">
                            <!-- Devices populated by JS -->
                        </select>
                        <div class="fm-storage">
                            <span class="fm-storage-text">-- / --</span>
                            <div class="fm-storage-bar"><div class="fm-storage-fill" style="width: 0%"></div></div>
                            <span class="fm-storage-percent">--%</span>
                        </div>
                        <div class="fm-path" id="fm-path-left">/</div>
                    </div>
                    <div class="fm-list" id="fm-list-left"></div>
                </div>
                <!-- Right Pane -->
                <div class="fm-pane" id="fm-pane-right">
                    <div class="fm-pane-header">
                        <select class="form-input" id="fm-device-right" onchange="App.fm.rightDevice = this.value; App.loadFilePane('right')">
                            <!-- Devices populated by JS -->
                        </select>
                        <div class="fm-storage">
                            <span class="fm-storage-text">-- / --</span>
                            <div class="fm-storage-bar"><div class="fm-storage-fill" style="width: 0%"></div></div>
                            <span class="fm-storage-percent">--%</span>
                        </div>
                        <div class="fm-path" id="fm-path-right">/</div>
                    </div>
                    <div class="fm-list" id="fm-list-right"></div>
                </div>
            </div>
            <div class="fm-actions">
                <button class="fm-btn" disabled><i data-lucide="copy"></i> Copy</button>
                <button class="fm-btn" disabled><i data-lucide="scissors"></i> Move</button>
                <button class="fm-btn danger" disabled><i data-lucide="trash-2"></i> Delete</button>
                <button class="fm-btn" disabled><i data-lucide="download"></i> Download</button>
                <button class="fm-btn" disabled><i data-lucide="upload"></i> Upload</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="/js/api.js"></script>
    <script src="/js/ui.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>
